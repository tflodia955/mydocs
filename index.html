<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MyDocs -YOUR DOCUMENTS YOUR CONTROL üìë</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4f46e5; --p-soft: #e0e7ff; --bg: #f8fafc; --card: #ffffff;
            --text: #0f172a; --text-light: #64748b; --border: #e2e8f0; --danger: #ef4444; --star: #f59e0b;
        }
        body.dark-mode {
            --bg: #020617; --card: #0f172a; --text: #f1f5f9; --text-light: #94a3b8; --border: #1e293b; --p-soft: #1e1b4b;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; transition: 0.3s; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }

        /* --- Branding Logos --- */
        .app-logo { height: 35px; border-radius: 8px; vertical-align: middle; }
        .modal-logo { height: 100px; margin-bottom: 15px; }

        /* --- Custom Professional Loader --- */
        #loader {
            position: fixed; top:0; left:0; width:100%; height:100%; background: var(--bg);
            display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 10000;
        }
        .loading-bar-wrap { width: 200px; height: 6px; background: var(--border); border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .loading-bar-fill { height: 100%; width: 0%; background: var(--primary); transition: 0.3s; box-shadow: 0 0 10px var(--primary); }

        /* --- Skeleton Loading --- */
        .skeleton { height: 85px; background: var(--border); border-radius: 20px; margin-bottom: 12px; position: relative; overflow: hidden; }
        .skeleton::after { content: ""; position: absolute; top:0; left:-100%; width:100%; height:100%; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent); animation: shimmer 1.5s infinite; }
        @keyframes shimmer { 100% { left: 100%; } }

        /* --- Layout --- */
        header { padding: 15px 20px; background: var(--card); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); position: sticky; top:0; z-index: 999; }
        .banner { margin: 15px; background: linear-gradient(135deg, var(--primary), #8b5cf6); border-radius: 24px; padding: 25px; color: white; position: relative; overflow: hidden; }
        .banner-img { position: absolute; right: -10px; height: 110%; opacity: 0.15; transform: rotate(-10deg); }

        .storage-box { padding: 0 20px; margin-bottom: 15px; }
        .st-track { height: 6px; background: var(--border); border-radius: 10px; margin-top: 6px; overflow: hidden; }
        .st-fill { height: 100%; background: var(--primary); width: 0%; transition: 1s ease; }

        .chips { display: flex; gap: 8px; padding: 10px 20px; overflow-x: auto; scrollbar-width: none; }
        .chip { padding: 8px 18px; background: var(--card); border: 1px solid var(--border); border-radius: 20px; font-size: 12px; font-weight: 700; cursor: pointer; white-space: nowrap; }
        .chip.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* --- File List --- */
        .file-list { padding: 10px 15px; }
        .file-card { background: var(--card); border-radius: 20px; padding: 15px; margin-bottom: 12px; display: flex; align-items: center; gap: 15px; border: 1px solid var(--border); }
        .f-icon { width: 50px; height: 50px; background: #fee2e2; color: #ef4444; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .f-info { flex: 1; min-width: 0; }
        .f-name { font-weight: 700; font-size: 14px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .f-meta { font-size: 11px; color: var(--text-light); margin-top: 4px; }
        .f-actions { display: flex; gap: 5px; }
        .f-actions i { padding: 10px; color: #94a3b8; cursor: pointer; border-radius: 10px; }
        .f-actions i.active-star { color: var(--star) !important; }

        /* --- Modals --- */
        .modal-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 10000; backdrop-filter: blur(8px); }
        .modal-box { background: var(--card); padding: 30px 25px; border-radius: 30px; width: 90%; max-width: 380px; text-align: center; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { transform: scale(0.85); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- Auth --- */
        .auth-card { background: var(--card); padding: 40px 30px; border-radius: 32px; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 15px; margin: 8px 0; border: 1.5px solid var(--border); border-radius: 16px; background: var(--bg); color: var(--text); outline: none; }
        .btn-p { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 16px; font-weight: 800; cursor: pointer; margin-top: 15px; }

        .fab { position: fixed; bottom: 90px; right: 20px; width: 64px; height: 64px; background: var(--primary); color: white; border-radius: 22px; display: flex; justify-content: center; align-items: center; font-size: 24px; box-shadow: 0 10px 25px rgba(79, 70, 229, 0.4); z-index: 998; }
        footer { position: fixed; bottom: 0; width: 100%; background: var(--card); padding: 18px; text-align: center; border-top: 1px solid var(--border); font-size: 11px; font-weight: 700; color: #94a3b8; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <!-- Professional Loader Overlay -->
    <div id="loader" class="loader-overlay">
        <img src="logo.png" class="modal-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/338/338046.png'">
        <p id="lMsg" style="font-weight:700; margin-top:10px;">Establishing Connection...</p>
        <div class="loading-bar-wrap">
            <div id="lBar" class="loading-bar-fill"></div>
        </div>
        <h2 id="lPercent" style="margin:10px 0 0">0%</h2>
    </div>

    <!-- Modals -->
    <div id="modal" class="modal-overlay">
        <div class="modal-box">
            <img src="logo.png" class="app-logo" style="margin-bottom:15px;" onerror="this.src='https://cdn-icons-png.flaticon.com/512/338/338046.png'">
            <h3 id="mTitle" style="margin:0 0 10px 0; font-weight:800;">Notice</h3>
            <p id="mMsg" style="color:var(--text-light); font-size:14px; margin-bottom:20px;"></p>
            <div id="mInputArea" class="hidden">
                <input type="text" id="mInput">
                <select id="mCat" class="hidden">
                    <option value="General">General</option>
                    <option value="Work">Work</option>
                    <option value="Personal">Personal</option>
                    <option value="Education">Education</option>
                </select>
            </div>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn-p" style="background:var(--border); color:var(--text); box-shadow:none" onclick="closeM()">Cancel</button>
                <button class="btn-p" id="mConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Login -->
    <div id="loginPage" style="height:100vh; display:flex; justify-content:center; align-items:center;">
        <div class="auth-card">
            <img src="logo.png" class="modal-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/338/338046.png'">
            <h2 style="margin:0; font-weight:800;">MyDocs </h2>
            <input type="email" id="lEmail" placeholder="Email Address">
            <input type="password" id="lPin" placeholder="4-Digit PIN">
            <button class="btn-p" onclick="login()">Enter Vault</button>
            <p style="margin-top:20px; font-size:14px; font-weight:700;">New user? <span style="color:var(--primary); cursor:pointer" onclick="toggleAuth(true)">Register</span></p>
        </div>
    </div>

    <!-- Register -->
    <div id="registerPage" class="auth-card hidden" style="margin: 50px auto;">
        <img src="YOUR_LOGO_URL" class="modal-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/338/338046.png'">
        <h2 style="margin:0; font-weight:800;">Create Vault</h2>
        <input type="text" id="rName" placeholder="Full Name">
        <input type="email" id="rEmail" placeholder="Email Address">
        <input type="password" id="rPin" placeholder="Set PIN" maxlength="4">
        <button class="btn-p" onclick="askOTP()">Verify Email</button>
        <p style="margin-top:20px; font-size:14px; font-weight:700;">Back to <span style="color:var(--primary); cursor:pointer" onclick="toggleAuth(false)">Login</span></p>
    </div>

    <!-- Dashboard -->
    <div id="appPage" class="hidden">
        <header>
            <div class="logo">
                <img src="logo.png" class="app-logo" onerror="this.src='https://cdn-icons-png.flaticon.com/512/338/338046.png'">
                <span style="font-weight:800; font-size:1.2rem; margin-left:8px; color:var(--primary)">MyDocs</span>
            </div>
            <div style="display:flex; gap:15px; align-items:center;">
                <i class="fas fa-moon" id="tBtn" onclick="toggleTheme()" style="cursor:pointer; color:var(--text-light)"></i>
                <i class="fas fa-power-off" onclick="logout()" style="color:var(--danger); cursor:pointer"></i>
            </div>
        </header>

        <div class="banner">
            <div style="z-index: 1;">
                <h2 id="hello" style="margin:0; font-weight:800;">Hello!</h2>
                <p id="today" style="margin:5px 0 0; font-size:12px; font-weight:600; opacity:0.9;"></p>
            </div>
            <img src="https://www.gstatic.com/classroom/themes/img_code.jpg" class="banner-img">
        </div>

        <div class="storage-box">
            <div style="display:flex; justify-content:space-between; font-size:11px; font-weight:800;">
                <span>Storage Indicator</span> <span id="stTxt">0 MB / 100 GB</span>
            </div>
            <div class="st-track"><div id="stFill" class="st-fill"></div></div>
        </div>

        <div class="chips">
            <div class="chip active" onclick="filterCat('All', this)">All Docs</div>
            <div class="chip" onclick="filterCat('Starred', this)">‚òÖ Starred</div>
            <div class="chip" onclick="filterCat('Work', this)">Work</div>
            <div class="chip" onclick="filterCat('Personal', this)">Personal</div>
            <div class="chip" onclick="filterCat('Education', this)">Education</div>
        </div>

        <div style="padding:0 20px; display:flex; gap:10px;">
            <input type="text" id="search" placeholder="Search by name..." onkeyup="search()" style="margin:0; flex:1">
            <select id="sort" onchange="search()" style="margin:0; width:auto; padding:0 10px;">
                <option value="new">New</option>
                <option value="name">Name</option>
                <option value="size">Size</option>
            </select>
        </div>

        <div class="file-list" id="fileList">
            <div class="skeleton"></div><div class="skeleton"></div><div class="skeleton"></div>
        </div>

        <div class="fab" onclick="document.getElementById('fileInput').click()"><i class="fas fa-plus"></i></div>
        <input type="file" id="fileInput" class="hidden" accept="application/pdf" onchange="handleUpload()">
    </div>

    <footer>BY SURAJ‚Ä¢  I ‚ù§Ô∏è  ODISHA</footer>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxy6NSWIWTE0ByN_G2ewrz_Gnu73Zlg9yFZdiDs-S3euPS3XPCaUtCBbzoTZ4I6K6qA/exec";
        let userEmail = localStorage.getItem("email"), userName = localStorage.getItem("name"), allFiles = [], currentCat = "All";

        window.onload = () => {
            if(localStorage.getItem('theme') === 'dark') toggleTheme(true);
            document.getElementById('today').innerText = new Date().toDateString();
            if(userEmail) showDash();
        };

        function toggleTheme(init) {
            const isDark = document.body.classList.toggle('dark-mode');
            if(!init) localStorage.setItem('theme', isDark ? 'dark' : 'light');
            document.getElementById('tBtn').className = isDark ? 'fas fa-sun' : 'fas fa-moon';
        }

        function toggleAuth(reg) {
            document.getElementById('loginPage').classList.toggle('hidden', reg);
            document.getElementById('registerPage').classList.toggle('hidden', !reg);
        }

        function showM(title, msg, type='alert', onConfirm=null, placeholder='') {
            document.getElementById('mTitle').innerText = title;
            document.getElementById('mMsg').innerText = msg;
            const inputArea = document.getElementById('mInputArea'), input = document.getElementById('mInput'), cat = document.getElementById('mCat');
            inputArea.classList.toggle('hidden', type !== 'prompt' && type !== 'upload');
            cat.classList.toggle('hidden', type !== 'upload');
            input.placeholder = placeholder; input.value = "";
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('mConfirm').onclick = () => {
                const val = input.value;
                document.getElementById('modal').style.display = 'none';
                if(onConfirm) onConfirm(val, cat.value);
            };
        }
        function closeM() { document.getElementById('modal').style.display = 'none'; }

        async function askOTP() {
            const n = document.getElementById('rName').value, e = document.getElementById('rEmail').value, p = document.getElementById('rPin').value;
            if(!n || !e || p.length < 4) return showM("Error", "Please fill all fields.");
            toggleLoad(true, 30, "Sending Secure OTP...");
            const res = await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({action:"register_request", email:e})});
            const data = await res.json();
            toggleLoad(false);
            if(data.status === "success") {
                showM("Verification", "Enter 4-digit OTP sent to email", "prompt", (val) => {
                    if(val == data.otp) finishReg(n, e, p);
                    else showM("Failed", "Incorrect OTP code.");
                }, "Enter OTP");
            } else showM("Error", data.msg);
        }

        async function finishReg(n, e, p) {
            toggleLoad(true, 70, "Finalizing Vault...");
            await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({action:"register_confirm", name:n, email:e, pin:p})});
            toggleLoad(false);
            showM("Success", "Account created! Now login.", "alert", () => toggleAuth(false));
        }

        async function login() {
            const e = document.getElementById('lEmail').value, p = document.getElementById('lPin').value;
            toggleLoad(true, 50, "Authenticating...");
            const res = await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({action:"login", email:e, pin:p})});
            const data = await res.json();
            toggleLoad(false);
            if(data.status === "success") {
                localStorage.setItem("email", e); localStorage.setItem("name", data.name);
                userEmail = e; userName = data.name; showDash();
            } else showM("Error", data.msg);
        }

        function showDash() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('registerPage').classList.add('hidden');
            document.getElementById('appPage').classList.remove('hidden');
            document.getElementById('hello').innerText = "Hello, " + userName + "!";
            loadFiles();
        }

        async function loadFiles() {
            const res = await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({action:"list", email:userEmail})});
            const data = await res.json();
            allFiles = data.files || [];
            document.getElementById('stTxt').innerText = data.storageUsed + " MB / 10 GB";
            document.getElementById('stFill').style.width = Math.min((data.storageUsed / 50) * 100, 100) + "%";
            search();
        }

        function renderFiles(list) {
            const container = document.getElementById('fileList');
            container.innerHTML = list.length ? "" : "<p style='text-align:center; padding:50px; color:var(--text-light);'>No Documents Found.</p>";
            list.forEach(f => {
                container.innerHTML += `
                    <div class="file-card">
                        <div class="f-icon"><i class="fas fa-file-pdf"></i></div>
                        <div class="f-info" onclick="window.open('${f.url}')">
                            <div class="f-name">${f.name}</div>
                            <div class="f-meta">${f.size} ‚Ä¢ ${f.date} ‚Ä¢ ${f.category}</div>
                        </div>
                        <div class="f-actions">
                            <i class="fas fa-star ${f.starred?'active-star':''}" onclick="toggleStar('${f.id}')"></i>
                            <i class="fas fa-share-alt" onclick="shareDoc('${f.url}')"></i>
                            <i class="fas fa-trash-alt" style="color:var(--danger)" onclick="delDoc('${f.id}')"></i>
                        </div>
                    </div>`;
            });
        }

        function handleUpload() {
            const file = document.getElementById('fileInput').files[0];
            if(!file) return;
            showM("New Document", "Enter Name & Category", "upload", (name, cat) => {
                if(name) performUpload(file, name, cat);
            }, "File Name");
        }

        async function performUpload(file, name, cat) {
            toggleLoad(true, 10, "Reading File...");
            const reader = new FileReader();
            reader.onload = async (e) => {
                toggleLoad(true, 50, "Uploading to Drive...");
                await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({
                    action:"upload", email:userEmail, fileName:name, category:cat, base64:e.target.result
                })});
                toggleLoad(true, 100, "Success!");
                setTimeout(() => { toggleLoad(false); loadFiles(); }, 600);
            };
            reader.readAsDataURL(file);
        }

        function shareDoc(url) {
            navigator.clipboard.writeText(url);
            showM("Link Copied", "Shareable link copied to clipboard.", "alert");
        }

        async function toggleStar(id) {
            await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({action:"toggle_star", email:userEmail, fileId:id})});
            loadFiles();
        }

        function delDoc(id) {
            showM("Delete", "This will move file to trash. Continue?", "confirm", async () => {
                toggleLoad(true, 80, "Deleting...");
                await fetch(SCRIPT_URL, {method:"POST", body:JSON.stringify({action:"delete", email:userEmail, fileId:id})});
                toggleLoad(false); loadFiles();
            });
        }

        function filterCat(cat, el) {
            currentCat = cat;
            document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            search();
        }

        function search() {
            let list = [...allFiles];
            const q = document.getElementById('search').value.toLowerCase();
            const sort = document.getElementById('sort').value;
            if(currentCat === "Starred") list = list.filter(f => f.starred);
            else if(currentCat !== "All") list = list.filter(f => f.category === currentCat);
            list = list.filter(f => f.name.toLowerCase().includes(q));
            if(sort === "name") list.sort((a,b) => a.name.localeCompare(b.name));
            else if(sort === "size") list.sort((a,b) => b.sizeRaw - a.sizeRaw);
            else list.sort((a,b) => new Date(b.date) - new Date(a.date));
            renderFiles(list);
        }

        function logout() { localStorage.clear(); location.reload(); }

        function toggleLoad(show, p, msg) {
            document.getElementById('loader').style.display = show ? 'flex' : 'none';
            document.getElementById('lBar').style.width = p + "%";
            document.getElementById('lPercent').innerText = p + "%";
            document.getElementById('lMsg').innerText = msg;
        }
        
        
        
        // Automatic refresh every 30 seconds
setInterval(() => {
    if (userEmail && document.visibilityState === 'visible') {
        console.log("Real-time Refreshing...");
        loadFiles(); // Nayi files aur storage refresh karega
    }
}, 30000); // 30000ms = 30 seconds
    </script>
</body>
</html>